using MySql.Data.MySqlClient;
using SysAgropec.Class;
using System;
using System.Collections.Generic;
using System.Configuration;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.Web.Routing;
using SysAgropec.Models;

namespace SysAgropec.Controllers
{
    public class LoginController : Controller
    {
        // GET: Login
        public ActionResult Index()
        {
            return View();
        }

        // GET: Login
        public ActionResult Logar()
        {

            return View();

        }

        [HttpPost]
        public ActionResult Valida()
        {
       
            string name = Request.Form["usuario"];
            string password = Request.Form["senha"];

            FazendaViewModel f = new FazendaViewModel();



            

            //string query = "Select * from usuarios where login = @login and senha = @senha";

            //MySqlConnection Conexao = new MySqlConnection(Banco.getConexao());
            
            //MySqlCommand command = Conexao.CreateCommand();
            //command.CommandText = query;
            //command.Parameters.AddWithValue("@login", name);
            //command.Parameters.AddWithValue("@senha", password);

            //try
            //{
            //    Conexao.Open();
            //}
            //catch (Exception msg )
            //{
            //    Console.WriteLine(msg.Message);
            //}

            //MySqlDataReader reader = command.ExecuteReader();
            //if (reader.HasRows)
            //{
         
            //    while (reader.Read())

            //    {
            //        Session.Add("iduser", reader["id"]);
            //        Session.Add("loginuser", reader["login"]);
            //        Session.Add("administrador", Convert.ToBoolean(reader["admin"]));
            //        if (Convert.ToBoolean(reader["admin"])) {
            //            DataTable dtPropriedades = new DataTable();
            //            reader.Dispose();
            //            Conexao.Close();
            //            query = "Select * from propriedades ";
            //            MySqlConnection Conexao2 = new MySqlConnection(Banco.getConexao());
            //            MySqlCommand command2 = Conexao2.CreateCommand();
            //            command2.CommandText = query;
            //            Conexao2.Open();
            //            //MySqlDataReader reader2 = command2.ExecuteReader();

            //            MySqlDataAdapter sqlDa = new MySqlDataAdapter(query, Conexao2);
            //            sqlDa.Fill(dtPropriedades);
                        
            //            if (dtPropriedades.Rows.Count> 0)
            //            {
                            
            //                return RedirectToAction("Manipular", new RouteValueDictionary(
            //                new { controller = "Fazenda", action = "Manipular", dtPropriedades }));
            //            }
            //        }
            //        else
            //        {
            //            query = "Select * from propriedades inner join usuarios_propriedades on propriedades.id =  ";
            //            query = query + " usuarios_propriedades.propriedades.id where usuarios_propriedades.usuarios_id = " + Session["iduser"];

            //            command = Conexao.CreateCommand();
            //            command.CommandText = query;

            //            MySqlDataReader reader2 = command.ExecuteReader();

            //            if (reader2.HasRows)
            //            {

            //                return View("", reader2);
            //            }

            //        }
                
            //    }
            //}
            //else //usuario não localizado
            //{

            //}

            return View();
           
        }
    }
}